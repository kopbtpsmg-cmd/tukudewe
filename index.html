<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Tuku Dewe Yo</title>

  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .menu-item, .cart-item {
      border: 1px solid #ccc; 
      padding: 10px; 
      margin: 5px 0; 
      border-radius: 5px;
    }
    .btn { 
      padding: 8px 12px; 
      background: black; 
      color: white; 
      border: none; 
      cursor: pointer; 
    }
    .btn-danger { background: red; }
  </style>
</head>

<body>

<h2>Daftar Menu</h2>
<div id="menu"></div>

<hr>

<h2>Keranjang</h2>
<div id="cart"></div>
<p><strong>Total:</strong> Rp <span id="grandTotal">0</span></p>

<hr>

<h3>Data Pelanggan</h3>
<input id="pelanggan" placeholder="Nama pelanggan" style="width:100%; padding:8px;"><br><br>
<textarea id="catatan" placeholder="Catatan (opsional)" rows="3" style="width:100%; padding:8px;"></textarea><br><br>

<button class="btn" onclick="submitOrder()">Kirim Pesanan</button>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbykGlqHp0gdUSuuTHntWcvYmaKOz2oJrfm41rbmVsYJdFczsNQ_Zu6yaf0MXBP28Ps-Lg/exec";

// DATA
let menu = [];
let cart = [];

// ===========================
// 1. AMBIL DATA MENU
// ===========================
// fetch(SCRIPT_URL)
//  .then(res => res.json())
//  .then(data => {
 //   console.log("DATA MENU:", data);
//    menu = data;          // Data dari GAS
//    renderMenu();         // Tampilkan menu
//  })
//  .catch(err => console.error("Gagal ambil menu:", err)); //
//
 fetch(SCRIPT_URL)
  .then(res => res.text())
  .then(txt => {
    console.log("RAW RESPONSE:", txt);

    let data;
    try {
      data = JSON.parse(txt);
    } catch (err) {
      console.error("Gagal parse JSON:", err);
      return;
    }

    console.log("DATA MENU:", data);
    menu = data;
    renderMenu();
  })
  .catch(err => console.error("Gagal ambil menu:", err)); 
// ===========================
// 2. TAMPILKAN MENU
// ===========================
function renderMenu() {
  const container = document.getElementById("menu");
  container.innerHTML = "";

  menu.forEach(item => {
    container.innerHTML += `
      <div class="menu-item">
        <strong>${item.name}</strong><br>
        Harga: Rp ${item.price}<br><br>
        <button class="btn" onclick="addToCart(${item.id})">Tambah</button>
      </div>
    `;
  });
}
// ===========================
// 3. TAMBAH KE KERANJANG
// ===========================
function addToCart(id) {
  const item = menu.find(x => x.id === id);
  if (!item) return alert("Menu tidak ditemukan!");

  const exist = cart.find(x => x.id === id);

  if (exist) exist.qty++;
  else cart.push({ id: item.id, name: item.name, price: item.price, qty: 1 });

  renderCart();
}

// ===========================
// 4. TAMPILKAN KERANJANG
// ===========================
function renderCart() {
  const container = document.getElementById("cart");
  container.innerHTML = "";

  cart.forEach(item => {
    container.innerHTML += `
      <div class="cart-item">
        ${item.name}<br>
        Rp ${item.price} x ${item.qty} = <strong>Rp ${item.price * item.qty}</strong><br><br>
        <button class="btn" onclick="changeQty(${item.id}, 1)">+</button>
        <button class="btn btn-danger" onclick="changeQty(${item.id}, -1)">-</button>
      </div>
    `;
  });

  // Hitung total
  const total = cart.reduce((s, i) => s + (i.price * i.qty), 0);
  document.getElementById("grandTotal").textContent = total;
}

// ===========================
// 5. UBAH JUMLAH / HAPUS ITEM
// ===========================
function changeQty(id, amount) {
  const item = cart.find(i => i.id === id);
  if (!item) return;

  item.qty += amount;

  if (item.qty <= 0) {
    cart = cart.filter(i => i.id !== id);
  }

  renderCart();
}

// ===========================
// 6. KIRIM PESANAN
// ===========================
function submitOrder() {
  if (cart.length === 0) return alert("Keranjang masih kosong!");

  const pelanggan = document.getElementById("pelanggan").value;
  const catatan = document.getElementById("catatan").value;

  const payload = {
    pelanggan: pelanggan,
    catatan: catatan,
    items: cart.map(i => ({
      name: i.name,
      qty: i.qty,
      price: i.price,
      total: i.price * i.qty
    }))
  };

  fetch(SCRIPT_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  })
  .then(res => res.text())
  .then(txt => {
    alert("Pesanan berhasil dikirim!");
    cart = [];
    renderCart();
  })
  .catch(err => {
    console.error(err);
    alert("Gagal mengirim pesanan!");
  });
}
</script>

</body>
</html>










